<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Provides ability to send network notifications."><meta name="keywords" content="rust, rustlang, rust-lang, NetworkNotification"><title>NetworkNotification in sc_network_common::service - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../sc_network_common/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../sc_network_common/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">NetworkNotification</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.notification_sender">notification_sender</a></li><li><a href="#tymethod.write_notification">write_notification</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul><li><a href="#impl-NetworkNotification-for-Arc%3CT%3E">Arc&lt;T&gt;</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In sc_network_common::service</a></h2></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../sc_network_common/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1">
                                <a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="../index.html">sc_network_common</a>::<wbr><a href="index.html">service</a>::<wbr><a class="trait" href="#">NetworkNotification</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/sc_network_common/service.rs.html#414-507">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait NetworkNotification {
    fn <a href="#tymethod.write_notification" class="fnname">write_notification</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target: PeerId,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protocol: <a class="enum" href="../protocol/enum.ProtocolName.html" title="enum sc_network_common::protocol::ProtocolName">ProtocolName</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;);
<span class="item-spacer"></span>    fn <a href="#tymethod.notification_sender" class="fnname">notification_sender</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target: PeerId,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protocol: <a class="enum" href="../protocol/enum.ProtocolName.html" title="enum sc_network_common::protocol::ProtocolName">ProtocolName</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="trait.NotificationSender.html" title="trait sc_network_common::service::NotificationSender">NotificationSender</a>&gt;, <a class="enum" href="enum.NotificationSenderError.html" title="enum sc_network_common::service::NotificationSenderError">NotificationSenderError</a>&gt;;
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Provides ability to send network notifications.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.write_notification" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/sc_network_common/service.rs.html#434">source</a></div><h4 class="code-header">fn <a href="#tymethod.write_notification" class="fnname">write_notification</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;target: PeerId,<br>&nbsp;&nbsp;&nbsp;&nbsp;protocol: <a class="enum" href="../protocol/enum.ProtocolName.html" title="enum sc_network_common::protocol::ProtocolName">ProtocolName</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;message: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;<br>)</h4></div></summary><div class="docblock"><p>Appends a notification to the buffer of pending outgoing notifications with the given peer.
Has no effect if the notifications channel with this protocol name is not open.</p>
<p>If the buffer of pending outgoing notifications with that peer is full, the notification
is silently dropped and the connection to the remote will start being shut down. This
happens if you call this method at a higher rate than the rate at which the peer processes
these notifications, or if the available network bandwidth is too low.</p>
<p>For this reason, this method is considered soft-deprecated. You are encouraged to use
<a href="trait.NetworkNotification.html#tymethod.notification_sender" title="NetworkNotification::notification_sender"><code>NetworkNotification::notification_sender</code></a> instead.</p>
<blockquote>
<p><strong>Note</strong>: The reason why this is a no-op in the situation where we have no channel is
that we don’t guarantee message delivery anyway. Networking issues can cause
connections to drop at any time, and higher-level logic shouldn’t differentiate
between the remote voluntarily closing a substream or a network error
preventing the message from being delivered.</p>
</blockquote>
<p>The protocol must have been registered with
<code>crate::config::NetworkConfiguration::notifications_protocols</code>.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.notification_sender" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/sc_network_common/service.rs.html#502-506">source</a></div><h4 class="code-header">fn <a href="#tymethod.notification_sender" class="fnname">notification_sender</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;target: PeerId,<br>&nbsp;&nbsp;&nbsp;&nbsp;protocol: <a class="enum" href="../protocol/enum.ProtocolName.html" title="enum sc_network_common::protocol::ProtocolName">ProtocolName</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="trait.NotificationSender.html" title="trait sc_network_common::service::NotificationSender">NotificationSender</a>&gt;, <a class="enum" href="enum.NotificationSenderError.html" title="enum sc_network_common::service::NotificationSenderError">NotificationSenderError</a>&gt;</h4></div></summary><div class="docblock"><p>Obtains a <a href="trait.NotificationSender.html" title="NotificationSender"><code>NotificationSender</code></a> for a connected peer, if it exists.</p>
<p>A <code>NotificationSender</code> is scoped to a particular connection to the peer that holds
a receiver. With a <code>NotificationSender</code> at hand, sending a notification is done in two
steps:</p>
<ol>
<li><a href="trait.NotificationSender.html#tymethod.ready" title="NotificationSender::ready"><code>NotificationSender::ready</code></a> is used to wait for the sender to become ready
for another notification, yielding a <a href="trait.NotificationSenderReady.html" title="NotificationSenderReady"><code>NotificationSenderReady</code></a> token.</li>
<li><a href="trait.NotificationSenderReady.html#tymethod.send" title="NotificationSenderReady::send"><code>NotificationSenderReady::send</code></a> enqueues the notification for sending. This operation
can only fail if the underlying notification substream or connection has suddenly closed.</li>
</ol>
<p>An error is returned by <a href="trait.NotificationSenderReady.html#tymethod.send" title="NotificationSenderReady::send"><code>NotificationSenderReady::send</code></a> if there exists no open
notifications substream with that combination of peer and protocol, or if the remote
has asked to close the notifications substream. If that happens, it is guaranteed that an
<a href="../protocol/event/enum.Event.html#variant.NotificationStreamClosed" title="Event::NotificationStreamClosed"><code>Event::NotificationStreamClosed</code></a> has been generated on the stream returned by
<a href="trait.NetworkEventStream.html#tymethod.event_stream" title="NetworkEventStream::event_stream"><code>NetworkEventStream::event_stream</code></a>.</p>
<p>If the remote requests to close the notifications substream, all notifications successfully
enqueued using <a href="trait.NotificationSenderReady.html#tymethod.send" title="NotificationSenderReady::send"><code>NotificationSenderReady::send</code></a> will finish being sent out before the
substream actually gets closed, but attempting to enqueue more notifications will now
return an error. It is however possible for the entire connection to be abruptly closed,
in which case enqueued notifications will be lost.</p>
<p>The protocol must have been registered with
<code>crate::config::NetworkConfiguration::notifications_protocols</code>.</p>
<h5 id="usage"><a href="#usage">Usage</a></h5>
<p>This method returns a struct that allows waiting until there is space available in the
buffer of messages towards the given peer. If the peer processes notifications at a slower
rate than we send them, this buffer will quickly fill up.</p>
<p>As such, you should never do something like this:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="comment">// Do NOT do this</span>
<span class="kw">for</span> <span class="ident">peer</span> <span class="kw">in</span> <span class="ident">peers</span> {
	<span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Ok</span>(<span class="ident">n</span>) <span class="op">=</span> <span class="ident">network</span>.<span class="ident">notification_sender</span>(<span class="ident">peer</span>, ...) {
			<span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Ok</span>(<span class="ident">s</span>) <span class="op">=</span> <span class="ident">n</span>.<span class="ident">ready</span>().<span class="kw">await</span> {
				<span class="kw">let</span> <span class="kw">_</span> <span class="op">=</span> <span class="ident">s</span>.<span class="ident">send</span>(...);
			}
	}
}</code></pre></div>
<p>Doing so would slow down all peers to the rate of the slowest one. A malicious or
malfunctioning peer could intentionally process notifications at a very slow rate.</p>
<p>Instead, you are encouraged to maintain your own buffer of notifications on top of the one
maintained by <code>sc-network</code>, and use <code>notification_sender</code> to progressively send out
elements from your buffer. If this additional buffer is full (which will happen at some
point if the peer is too slow to process notifications), appropriate measures can be taken,
such as removing non-critical notifications from the buffer or disconnecting the peer
using <a href="trait.NetworkPeers.html#tymethod.disconnect_peer" title="NetworkPeers::disconnect_peer"><code>NetworkPeers::disconnect_peer</code></a>.</p>
<p>Notifications              Per-peer buffer
broadcast    +—––&gt;   of notifications   +–&gt;  <code>notification_sender</code>  +–&gt;  Internet
^       (not covered by
|         sc-network)
+
Notifications should be dropped
if buffer is full</p>
<p>See also the <code>sc-network-gossip</code> crate for a higher-level way to send notifications.</p>
</div></details></div><h2 id="foreign-impls" class="small-section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor"></a></h2><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-NetworkNotification-for-Arc%3CT%3E" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/sc_network_common/service.rs.html#509-525">source</a></span><a href="#impl-NetworkNotification-for-Arc%3CT%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;T&gt; <a class="trait" href="trait.NetworkNotification.html" title="trait sc_network_common::service::NetworkNotification">NetworkNotification</a> for <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;T&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;T: <a class="trait" href="trait.NetworkNotification.html" title="trait sc_network_common::service::NetworkNotification">NetworkNotification</a>,&nbsp;</span></h3></section></summary><div class="impl-items"><section id="method.write_notification" class="method trait-impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/sc_network_common/service.rs.html#514-516">source</a></span><a href="#method.write_notification" class="anchor"></a><h4 class="code-header">fn <a href="#tymethod.write_notification" class="fnname">write_notification</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;target: PeerId,<br>&nbsp;&nbsp;&nbsp;&nbsp;protocol: <a class="enum" href="../protocol/enum.ProtocolName.html" title="enum sc_network_common::protocol::ProtocolName">ProtocolName</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;message: <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>&gt;<br>)</h4></section><section id="method.notification_sender" class="method trait-impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/sc_network_common/service.rs.html#518-524">source</a></span><a href="#method.notification_sender" class="anchor"></a><h4 class="code-header">fn <a href="#tymethod.notification_sender" class="fnname">notification_sender</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self,<br>&nbsp;&nbsp;&nbsp;&nbsp;target: PeerId,<br>&nbsp;&nbsp;&nbsp;&nbsp;protocol: <a class="enum" href="../protocol/enum.ProtocolName.html" title="enum sc_network_common::protocol::ProtocolName">ProtocolName</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="trait.NotificationSender.html" title="trait sc_network_common::service::NotificationSender">NotificationSender</a>&gt;, <a class="enum" href="enum.NotificationSenderError.html" title="enum sc_network_common::service::NotificationSenderError">NotificationSenderError</a>&gt;</h4></section></div></details><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../../implementors/sc_network_common/service/trait.NetworkNotification.js" data-ignore-extern-crates="alloc" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="sc_network_common" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (7fe022f5a 2022-07-24)" ></div>
</body></html>